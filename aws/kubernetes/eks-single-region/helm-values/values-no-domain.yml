---
identityKeycloak:
    enabled: false # not supported in a non-domain setup
    postgresql:
        enabled: false
    externalDatabase:
        # see https://artifacthub.io/packages/helm/bitnami/keycloak
        existingSecret: identity-keycloak-secret   # Name of an existing secret resource containing the database credentials
        existingSecretHostKey: host
        existingSecretPortKey: port
        existingSecretUserKey: user
        existingSecretDatabaseKey: database
        existingSecretPasswordKey: password
    auth:
        existingSecret: identity-secret-for-components
        passwordSecretKey: admin-password

# TODO: re-evaluate and potentially clean up
# 2025-09-03 - previous behaviour is not possible in a non-domain setup
# For now just promoting the Orchestration Cluster with basic auth, re-evaluate based on outcome of
# https://camunda.slack.com/archives/C08MRKHJ0CD/p1755246616281649
# The issuerBackendUrl is not supported atm by embedded Identity
# this means that publicIssuerUrl is used and must be accessible by both machines and users
# only workaround for users is to do atm host file modifications

global:
    elasticsearch:
        enabled: false
    opensearch:
        enabled: true
        aws:
            enabled: false # we rely on anonymous auth, not irsa, basic auth is not supported on managed OpenSearch
        auth:
            username:
            password:
        url:
            protocol: https
            host: ${OPENSEARCH_HOST}
            # Amazon OpenSearch Service listens on port 443 opposed to the usual port 9200.
            port: 443

    identity:

        auth:
            enabled: false # not supported in a non-domain setup
            publicIssuerUrl: http://localhost:18080/auth/realms/camunda-platform  # replace this with a port of your choice when you will do port forwarding
            issuerBackendUrl: http://camunda-keycloak/auth/realms/camunda-platform

            orchestration:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: orchestration-secret
                redirectUrl: http://localhost:8082  # replace this with a port of your choice when you will do port forwarding
            connectors:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: connectors-secret
            optimize:
                redirectUrl: http://localhost:8083/optimize  # replace this with a port of your choice when you will do port forwarding
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: optimize-secret
            webModeler:
                redirectUrl: http://localhost:8084/modeler
            console:
                redirectUrl: http://localhost:8085/console
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: console-secret

# not supported in a non-domain setup
# orchestration:
#     security:
#         authentication:
#             method: oidc

identity:
    enabled: false # not supported in a non-domain setup
    contextPath: /managementidentity
    fullURL: http://localhost:8080/managementidentity # replace this with a port of your choice when you will do port forwarding

    # TODO: if oidc is supported in the end, this will need adjustment in the docs
    firstUser:
        enabled: false
        secret:
            existingSecret: identity-secret-for-components
            existingSecretKey: first-user-password # demo

    externalDatabase:
        enabled: true
        host: ${DB_HOST}
        port: 5432
        username: ${DB_IDENTITY_USERNAME}
        database: ${DB_IDENTITY_NAME}
        existingSecret: identity-postgres-secret
        existingSecretPasswordKey: password

webModeler:
    enabled: false # by default, webModeler is not enabled

    restapi:
        externalDatabase:
            url: jdbc:aws-wrapper:postgresql://${DB_HOST}:5432/${DB_WEBMODELER_NAME}
            user: ${DB_WEBMODELER_USERNAME}
            secret:
                existingSecret: webmodeler-postgres-secret
                existingSecretKey: password
        env:
            - name: SPRING_DATASOURCE_DRIVER_CLASS_NAME
              value: software.amazon.jdbc.Driver
        mail:
            secret:
                existingSecret: identity-secret-for-components # reference the smtp password
                existingSecretKey: smtp-password
            fromAddress: changeme@example.com   # change this required value

webModelerPostgresql:
    # Will deploy a postgresql datbase for webModeler.
    # If you enable webModeler, you either need to turn it true or use an external database
    enabled: false
    auth:
        existingSecret: identity-secret-for-components
        secretKeys:
            adminPasswordKey: identity-webmodeler-postgres-admin-password
            userPasswordKey: identity-webmodeler-postgres-user-password

optimize:
    enabled: false # not supported in a non-domain setup
    # OpenSearch prevents migration
    migration:
        enabled: false

console:
    enabled: false # by default, console is not enabled
    contextPath: /console

elasticsearch:
    enabled: false
