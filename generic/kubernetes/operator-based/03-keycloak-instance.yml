---
apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
    name: keycloak
spec:
    # TODO: renovate
    # TODO: source image upstream
    instances: 1
    db:
        host: pg-keycloak-rw # this service is provided by the CNPG keycloak
        port: 5432
        database: keycloak
        schema: public
        usernameSecret:
            name: pg-keycloak-secret
            key: username
        passwordSecret:
            name: pg-keycloak-secret
            key: password
    http:
        httpEnabled: true
    transaction:
        xaEnabled: false
    additionalOptions:
        - name: http-relative-path
          value: /auth
    ingress:
        enabled: false
        className: ${INGRESS_CLASS_NAME}
        # rules:
        #     - host: ${CAMUNDA_DOMAIN}
        #       paths:
        #           - path: /auth/(.*)
        #             pathType: Prefix
        annotations:
            kubernetes.io/tls-acme: 'true'
    hostname:
        hostname: ${CAMUNDA_DOMAIN}
        # TLS secret for HTTPS when ingress is enabled (remove for localhost/no-ingress)
        # tlsSecret: camunda-keycloak-tls
        # Dynamic backchannel for ingress environments (set to false for localhost/no-ingress)
        # backchannelDynamic: true
        strict: true
    resources:
        limits:
            cpu: 500m
            memory: 1Gi
        requests:
            cpu: 250m
            memory: 512Mi
