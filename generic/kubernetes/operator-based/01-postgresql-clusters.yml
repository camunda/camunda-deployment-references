---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
    name: pg-identity
    annotations:
        # OpenShift compatibility - use default runtime security profile
        container.apparmor.security.beta.kubernetes.io/postgres: runtime/default
        container.apparmor.security.beta.kubernetes.io/initdb: runtime/default
        container.apparmor.security.beta.kubernetes.io/join: runtime/default
spec:
    instances: 1
    description: PostgreSQL cluster for Camunda Identity
    storage:
        size: 15Gi
    superuserSecret:
        name: pg-identity-superuser-secret
    # OpenShift Security Context - let SCC manage the security context
    seccompProfile:
        type: RuntimeDefault
    bootstrap:
        initdb:
            database: identity
            owner: identity
            dataChecksums: true
            secret:
                name: pg-identity-secret
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
    name: pg-keycloak
    annotations:
        # OpenShift compatibility - use default runtime security profile
        container.apparmor.security.beta.kubernetes.io/postgres: runtime/default
        container.apparmor.security.beta.kubernetes.io/initdb: runtime/default
        container.apparmor.security.beta.kubernetes.io/join: runtime/default
spec:
    instances: 1
    description: PostgreSQL cluster for Keycloak
    storage:
        size: 15Gi
    superuserSecret:
        name: pg-keycloak-superuser-secret
    # OpenShift Security Context - let SCC manage the security context
    seccompProfile:
        type: RuntimeDefault
    postgresql:
        parameters:
            lock_timeout: 30s
            statement_timeout: '0'
    bootstrap:
        initdb:
            database: keycloak
            owner: keycloak
            dataChecksums: true
            secret:
                name: pg-keycloak-secret
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
    name: pg-webmodeler
    annotations:
        # OpenShift compatibility - use default runtime security profile
        container.apparmor.security.beta.kubernetes.io/postgres: runtime/default
        container.apparmor.security.beta.kubernetes.io/initdb: runtime/default
        container.apparmor.security.beta.kubernetes.io/join: runtime/default
spec:
    instances: 1
    description: PostgreSQL cluster for Webmodeler
    superuserSecret:
        name: pg-webmodeler-superuser-secret
    # OpenShift Security Context - let SCC manage the security context
    seccompProfile:
        type: RuntimeDefault
    bootstrap:
        initdb:
            database: webmodeler
            owner: webmodeler
            secret:
                name: pg-webmodeler-secret
    storage:
        size: 15Gi
