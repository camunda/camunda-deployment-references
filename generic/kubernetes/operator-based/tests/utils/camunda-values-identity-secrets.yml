---
global:
    identity:
        auth:
            orchestration:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-orchestration-client-token

            admin:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-admin-client-token

            optimize:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-optimize-client-token

            connectors:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-connectors-client-token

            webModeler:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-webmodeler-client-token

            console:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-console-client-token

identity:
    contextPath: /managementidentity

    # First user configuration
    firstUser:
        enabled: true
        username: admin
        email: admin@camunda-demo.local
        firstName: Admin
        lastName: User
        secret:
            existingSecret: identity-secret-for-components
            existingSecretKey: identity-first-user-password

# TODO: backport this in other RA
connectors:
    security:
        authentication:
            method: oidc
            oidc:
                secret:
                    # TODO: revert to new syntax once https://github.com/camunda/camunda-platform-helm/issues/4314 is fixed
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-connectors-client-token

# TODO: backport this in other RA
orchestration:
    security:
        authentication:
            method: oidc
            oidc:
                secret:
                    # TODO: revert to new syntax once https://github.com/camunda/camunda-platform-helm/issues/4314 is fixed
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-orchestration-client-token

        # We need to add a mapping for embedded identity
        # this will also overwrite the default mapping for demo user, so we need to readd it again
        # by default the Helm Chart adds any mapping to the admin role
        initialization:
            mappingRules:
                - mappingRuleID: venom-test-client-mapping
                  claimName: client_id
                  claimValue: venom
                - mappingRuleID: demo-user-mapping-rule
                  claimName: preferred_username
                  claimValue: demo

    #################### Only needed for keycloak auth
    env:
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_0_MAPPINGRULEID
          value: demo-user-mapping-rule
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_0_CLAIMNAME
          value: preferred_username
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_0_CLAIMVALUE
          value: demo
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_1_MAPPINGRULEID
          value: venom-client-mapping-rule
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_1_CLAIMNAME
          value: client_id
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_1_CLAIMVALUE
          value: venom
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_2_MAPPINGRULEID
          value: connectors-client-mapping-rule
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_2_CLAIMNAME
          value: client_id
        - name: CAMUNDA_SECURITY_INITIALIZATION_MAPPINGRULES_2_CLAIMVALUE
          value: connectors
        - name: CAMUNDA_SECURITY_INITIALIZATION_DEFAULTROLES_ADMIN_MAPPINGRULES_0
          value: demo-user-mapping-rule
        - name: CAMUNDA_SECURITY_INITIALIZATION_DEFAULTROLES_ADMIN_MAPPINGRULES_1
          value: venom-client-mapping-rule
        - name: CAMUNDA_SECURITY_INITIALIZATION_DEFAULTROLES_ADMIN_MAPPINGRULES_2
          value: connectors-client-mapping-rule
