---
# Helm values for CNPG-managed PostgreSQL (Identity)
# Based on: operator-based/postgresql/camunda-identity-values.yml
# Required env vars:
#   CNPG_CLUSTER_NAME
# Usage: envsubst < helm-values-cnpg.yml > values-cnpg.yaml
#        helm upgrade camunda camunda/camunda-platform --reuse-values -f values-cnpg.yaml

# Disable Bitnami PostgreSQL sub-chart for Identity
postgresql:
    enabled: false

# Configure Identity to use CNPG cluster
identity:
    enabled: true

    # Use external PostgreSQL
    externalDatabase:
        enabled: true
        host: ${CNPG_CLUSTER_NAME}-rw
        port: 5432
        database: ${PG_DATABASE}
        username: '' # Will be read from secret
        # Use the new secret configuration format
        secret:
            existingSecret: ${CNPG_CLUSTER_NAME}-secret
            existingSecretKey: password
