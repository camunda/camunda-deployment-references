---
# Keycloak Overlay Configuration for Camunda Platform
#
# This file contains ONLY the Keycloak-specific configuration.
# It should be merged with your base values file using yq:
#   yq ". *+ load("values-keycloak.yml")" values-domain.yml > values.yml
#
# Required environment variables (use envsubst before applying):
#   For domain mode:
#     - DOMAIN_NAME: Your domain name
#   For no-domain mode:
#     - CAMUNDA_RELEASE_NAME: Helm release name
#
#   Database credentials:
#     - DB_HOST: Database host
#     - DB_IDENTITY_USERNAME: Identity database username
#     - DB_IDENTITY_NAME: Identity database name

global:
    identity:
        auth:
            type: KEYCLOAK

identityKeycloak:
    enabled: true
    postgresql:
        enabled: false
    externalDatabase:
        # see https://artifacthub.io/packages/helm/bitnami/keycloak
        existingSecret: identity-keycloak-secret   # Name of an existing secret resource containing the database credentials
        existingSecretHostKey: host
        existingSecretPortKey: port
        existingSecretUserKey: user
        existingSecretDatabaseKey: database
        existingSecretPasswordKey: password
    auth:
        existingSecret: identity-secret-for-components
        passwordSecretKey: identity-admin-client-token

identity:
    enabled: true

    firstUser:
        enabled: true
        username: admin
        email: admin@camunda.local
        firstName: Admin
        lastName: User
        secret:
            existingSecret: identity-secret-for-components
            existingSecretKey: identity-first-user-password

    externalDatabase:
        enabled: true
        host: ${DB_HOST}
        port: 5432
        username: ${DB_IDENTITY_USERNAME}
        database: ${DB_IDENTITY_NAME}
        secret:
            existingSecret: identity-postgres-secret
            existingSecretPasswordKey: password

connectors:
    # Configure OIDC for connectors with Keycloak
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-connectors-client-token

orchestration:
    # Configure OIDC for orchestration with Keycloak
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: identity-secret-for-components
                    existingSecretKey: identity-orchestration-client-token
        initialization:
            defaultRoles:
                admin:
                    users:
                        - admin
