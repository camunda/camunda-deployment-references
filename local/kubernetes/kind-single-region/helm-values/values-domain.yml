---
# Camunda Platform Helm values for Kind local development WITH domain
#
# This configuration enables:
# - Ingress with TLS (via mkcert certificates)
# - Domain-based access (camunda.example.com)
# - OIDC authentication via Keycloak
#
# Prerequisites:
# - TLS certificates generated by: certs-create-secret.sh
# - Hosts file configured by: hosts-add.sh
# - For mkcert CA trust in pods, also use: values-mkcert.yml
#
# Used in combination with operator-based values from generic/kubernetes/operator-based/:
# - camunda-elastic-values.yml (Elasticsearch via ECK)
# - camunda-keycloak-domain-values.yml (Keycloak via operator, domain mode)
# - camunda-identity-values.yml (PostgreSQL for Identity via CloudNativePG)
# - camunda-webmodeler-values.yml (PostgreSQL for Web Modeler via CloudNativePG)

global:
    secrets:
        autoGenerated: true
        name: camunda-credentials

    identity:
        auth:
            console:
                redirectUrl: https://camunda.example.com/console

            identity:
                redirectUrl: https://camunda.example.com/managementidentity

            optimize:
                redirectUrl: https://camunda.example.com/optimize
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-optimize-client-token

            webModeler:
                redirectUrl: https://camunda.example.com/modeler

    ingress:
        enabled: true
        className: nginx
        host: camunda.example.com
        annotations:
            # Required for OIDC: Keycloak sends large JWT tokens in headers
            nginx.ingress.kubernetes.io/proxy-buffer-size: 128k
        tls:
            enabled: true
            secretName: camunda-platform

connectors:
    enabled: true
    inbound:
        mode: disabled
    resources:
        requests:
            cpu: 100m
            memory: 256Mi
        limits:
            cpu: 1000m
            memory: 1Gi
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-connectors-client-token

identity:
    enabled: true
    contextPath: /managementidentity
    fullURL: https://camunda.example.com/managementidentity

    resources:
        requests:
            cpu: 50m
            memory: 128Mi
        limits:
            cpu: 500m
            memory: 512Mi

    firstUser:
        enabled: true
        username: admin
        email: admin@camunda.local
        firstName: Admin
        lastName: User
        secret:
            existingSecret: camunda-credentials
            existingSecretKey: identity-firstuser-password

optimize:
    enabled: true
    contextPath: /optimize
    resources:
        requests:
            cpu: 200m
            memory: 256Mi
        limits:
            cpu: 1000m
            memory: 1Gi

# Reduce Zeebe resources for local development
orchestration:
    contextPath: /
    clusterSize: '1'
    partitionCount: '1'
    replicationFactor: '1'
    pvcSize: 10Gi
    resources:
        requests:
            cpu: 300m
            memory: 512Mi
        limits:
            cpu: 2000m
            memory: 2Gi
    ingress:
        grpc:
            enabled: true
            className: nginx
            host: zeebe-camunda.example.com
            tls:
                enabled: true
                secretName: camunda-platform
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-orchestration-client-token
        initialization:
            defaultRoles:
                admin:
                    users:
                        - admin

console:
    enabled: true
    contextPath: /console
    resources:
        requests:
            cpu: 50m
            memory: 64Mi
        limits:
            cpu: 500m
            memory: 256Mi

webModeler:
    contextPath: /modeler
    restapi:
        resources:
            requests:
                cpu: 100m
                memory: 256Mi
            limits:
                cpu: 1000m
                memory: 1Gi
    webapp:
        resources:
            requests:
                cpu: 50m
                memory: 128Mi
            limits:
                cpu: 500m
                memory: 512Mi
    websockets:
        resources:
            requests:
                cpu: 50m
                memory: 128Mi
            limits:
                cpu: 500m
                memory: 512Mi
