# Camunda Platform Helm values for Kind local development WITH domain
#
# This configuration enables:
# - Ingress with TLS (via mkcert certificates)
# - Domain-based access (camunda.example.com)
# - OIDC authentication via Keycloak
#
# Prerequisites:
# - TLS certificates generated by: certs-create-secret.sh
# - Hosts file configured by: hosts-add.sh
# - For mkcert CA trust in pods, also use: values-mkcert.yml

global:
  secrets:
    autoGenerated: true
    name: camunda-credentials

  security:
    authentication:
      method: oidc

  identity:
    auth:
      enabled: true
      type: "KEYCLOAK"
      publicIssuerUrl: "https://camunda.example.com/auth/realms/camunda-platform"
      issuer: "https://camunda.example.com/auth/realms/camunda-platform"

      optimize:
        redirectUrl: "https://camunda.example.com/optimize"
        secret:
          existingSecret: camunda-credentials
          existingSecretKey: identity-optimize-client-token

      console:
        redirectUrl: "https://camunda.example.com"

      webModeler:
        redirectUrl: "https://camunda.example.com/modeler"

  ingress:
    enabled: true
    className: ""
    host: "camunda.example.com"
    tls:
      enabled: true
      secretName: camunda-platform

connectors:
  enabled: true
  inbound:
    mode: disabled
  security:
    authentication:
      oidc:
        secret:
          existingSecret: camunda-credentials
          existingSecretKey: identity-connectors-client-token

# Configure ElasticSearch for local development
elasticsearch:
  master:
    replicaCount: 1
    persistence:
      size: 15Gi

identity:
  enabled: true
  contextPath: "/identity"
  fullURL: "https://camunda.example.com/identity"

  firstUser:
    enabled: true
    username: admin
    email: admin@camunda.local
    firstName: Admin
    lastName: User
    secret:
      existingSecret: camunda-credentials
      existingSecretKey: identity-firstuser-password

  # Keycloak client seed for querying Camunda APIs
  clients:
    - id: test
      name: Test
      secret:
        inlineSecret: test_token
      redirectUris: /dummy
      rootUrl: http://dummy
      type: confidential
      permissions:
        - resourceServerId: camunda-identity-resource-server
          definition: read
        - resourceServerId: camunda-identity-resource-server
          definition: write
        - resourceServerId: orchestration-api
          definition: read:*
        - resourceServerId: orchestration-api
          definition: write:*
        - resourceServerId: optimize-api
          definition: write:*
        - resourceServerId: web-modeler-api
          definition: write:*
        - resourceServerId: console-api
          definition: write:*

identityKeycloak:
  enabled: true

optimize:
  enabled: true
  contextPath: "/optimize"

# Reduce Zeebe resources for local development
orchestration:
  contextPath: "/orchestration"
  clusterSize: "1"
  partitionCount: "1"
  replicationFactor: "1"
  pvcSize: 10Gi
  ingress:
    grpc:
      enabled: true
      className: ""
      host: "zeebe-camunda.example.com"
      tls:
        enabled: true
        secretName: camunda-platform
  security:
    authentication:
      oidc:
        secret:
          existingSecret: camunda-credentials
          existingSecretKey: identity-orchestration-client-token
        redirectUrl: https://camunda.example.com/orchestration
    initialization:
      defaultRoles:
        admin:
          clients:
            - test

console:
  enabled: true
  contextPath: "/"

webModeler:
  enabled: true
  contextPath: "/modeler"
  restapi:
    mail:
      fromAddress: noreply@camunda.local

webModelerPostgresql:
  enabled: true
  auth:
    existingSecret: camunda-credentials

zeebeGateway:
  contextPath: "/zeebe"
