# Camunda Platform Helm values for Kind local development WITHOUT domain
#
# This configuration enables:
# - No Ingress (access via port-forward)
# - Local access via localhost with port forwarding
# - OIDC authentication via Keycloak

global:
  secrets:
    autoGenerated: true
    name: camunda-credentials

  security:
    authentication:
      method: oidc

  ingress:
    enabled: false

  identity:
    auth:
      enabled: true
      type: "KEYCLOAK"

      issuerBackendUrl: http://camunda-keycloak:8080/auth/realms/camunda-platform
      issuer: http://camunda-keycloak:8080/auth/realms/camunda-platform
      # using localhost:18080 -> keycloak-service:8080 (kubectl port-forward svc/keycloak-service 18080:8080)
      publicIssuerUrl: http://localhost:18080/auth/realms/camunda-platform

      identity:
        redirectUrl: http://localhost:8085

      console:
        redirectUrl: http://localhost:8087

      webModeler:
        redirectUrl: http://localhost:8070

connectors:
  enabled: true
  inbound:
    mode: disabled
  security:
    authentication:
      oidc:
        secret:
          existingSecret: camunda-credentials
          existingSecretKey: identity-connectors-client-token

# Configure ElasticSearch for local development
elasticsearch:
  master:
    replicaCount: 1
    persistence:
      size: 15Gi

identity:
  enabled: true

  contextPath: /managementidentity
  fullURL: http://localhost:18081/managementidentity # replace this with a port of your choice when you will do port forwarding

  firstUser:
    enabled: true
    username: admin
    email: admin@camunda.local
    firstName: Admin
    lastName: User
    secret:
      existingSecret: camunda-credentials
      existingSecretKey: identity-firstuser-password

  # Keycloak client seed for querying Camunda APIs
  clients:
    - id: test
      name: Test
      secret:
        inlineSecret: test_token
      redirectUris: /dummy
      rootUrl: http://dummy
      type: confidential
      permissions:
        - resourceServerId: camunda-identity-resource-server
          definition: read
        - resourceServerId: camunda-identity-resource-server
          definition: write
        - resourceServerId: orchestration-api
          definition: read:*
        - resourceServerId: orchestration-api
          definition: write:*
        - resourceServerId: optimize-api
          definition: write:*
        - resourceServerId: web-modeler-api
          definition: write:*
        - resourceServerId: console-api
          definition: write:*

identityKeycloak:
  enabled: true
  extraEnvVars:
    - name: KC_HOSTNAME
      value: camunda-keycloak
  # match the internal keycloak port to the external port for JWT Tokens issuer
  ports:
      http: 8080
  service:
      ports:
          http: 8080

optimize:
  enabled: false

# Reduce Zeebe resources for local development
orchestration:
  clusterSize: "1"
  partitionCount: "1"
  replicationFactor: "1"
  pvcSize: 10Gi
  security:
    authentication:
      oidc:
        secret:
          existingSecret: camunda-credentials
          existingSecretKey: identity-orchestration-client-token
        redirectUrl: http://localhost:8080
    initialization:
      defaultRoles:
        admin:
          clients:
            - admin
            - test

console:
  enabled: true

webModeler:
  enabled: true

webModelerPostgresql:
  enabled: true
