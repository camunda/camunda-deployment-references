---
# Camunda Platform Helm values for Kind local development WITHOUT domain
#
# This configuration enables:
# - No Ingress (access via port-forward)
# - Local access via localhost with port forwarding
# - OIDC authentication via Keycloak

global:
    secrets:
        autoGenerated: true
        name: camunda-credentials

    security:
        authentication:
            method: oidc

    ingress:
        enabled: false

    identity:
        auth:
            enabled: true
            type: KEYCLOAK

            issuerBackendUrl: http://camunda-keycloak:8080/auth/realms/camunda-platform
            issuer: http://camunda-keycloak:8080/auth/realms/camunda-platform
            # using localhost:18080 -> camunda-keycloak:8080 (kubectl port-forward svc/camunda-keycloak 18080:8080)
            publicIssuerUrl: http://localhost:18080/auth/realms/camunda-platform

            identity:
                redirectUrl: http://localhost:18081/managementidentity

            optimize:
                redirectUrl: http://localhost:8083
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-optimize-client-token

            console:
                redirectUrl: http://localhost:8087

            webModeler:
                redirectUrl: http://localhost:8070

connectors:
    enabled: true
    inbound:
        mode: disabled
    resources:
        requests:
            cpu: 100m
            memory: 256Mi
        limits:
            cpu: 1000m
            memory: 1Gi
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-connectors-client-token

# Configure ElasticSearch for local development
elasticsearch:
    master:
        replicaCount: 1
        persistence:
            size: 15Gi
        # Increase heap size for better stability
        heapSize: 1g
        resources:
            requests:
                cpu: 500m
                memory: 1536Mi
            limits:
                cpu: 2000m
                memory: 3Gi

identity:
    enabled: true

    contextPath: /managementidentity
    fullURL: http://localhost:18081/managementidentity # replace this with a port of your choice when you will do port forwarding

    resources:
        requests:
            cpu: 50m
            memory: 128Mi
        limits:
            cpu: 500m
            memory: 512Mi

    firstUser:
        enabled: true
        username: admin
        email: admin@camunda.local
        firstName: Admin
        lastName: User
        secret:
            existingSecret: camunda-credentials
            existingSecretKey: identity-firstuser-password

identityKeycloak:
    enabled: true
    extraEnvVars:
        - name: KC_HOSTNAME
          value: camunda-keycloak
    # match the internal keycloak port to the external port for JWT Tokens issuer
    ports:
        http: 8080
    service:
        ports:
            http: 8080
    resources:
        requests:
            cpu: 100m
            memory: 256Mi
        limits:
            cpu: 1000m
            memory: 1Gi

optimize:
    enabled: true
    # Elasticsearch migration is not needed when using bundled ES
    migration:
        enabled: false
    resources:
        requests:
            cpu: 200m
            memory: 256Mi
        limits:
            cpu: 1000m
            memory: 1Gi

# Reduce Zeebe resources for local development
orchestration:
    clusterSize: '1'
    partitionCount: '1'
    replicationFactor: '1'
    pvcSize: 10Gi
    resources:
        requests:
            cpu: 300m
            memory: 512Mi
        limits:
            cpu: 2000m
            memory: 2Gi
    security:
        authentication:
            oidc:
                secret:
                    existingSecret: camunda-credentials
                    existingSecretKey: identity-orchestration-client-token
                redirectUrl: http://localhost:8080
        initialization:
            defaultRoles:
                admin:
                    users:
                        - admin

console:
    enabled: true
    resources:
        requests:
            cpu: 50m
            memory: 64Mi
        limits:
            cpu: 500m
            memory: 256Mi

webModeler:
    enabled: true
    restapi:
        mail:
            fromAddress: noreply@camunda.local
        resources:
            requests:
                cpu: 100m
                memory: 256Mi
            limits:
                cpu: 1000m
                memory: 1Gi
    webapp:
        resources:
            requests:
                cpu: 50m
                memory: 128Mi
            limits:
                cpu: 500m
                memory: 512Mi
    websockets:
        resources:
            requests:
                cpu: 50m
                memory: 128Mi
            limits:
                cpu: 500m
                memory: 512Mi

webModelerPostgresql:
    enabled: true
    auth:
        existingSecret: camunda-credentials
    primary:
        resources:
            requests:
                cpu: 100m
                memory: 128Mi
            limits:
                cpu: 1000m
                memory: 512Mi
